# æ™ºèƒ½ä»»åŠ¡è°ƒåº¦ç»ˆç«¯åº”ç”¨

è¿™æ˜¯ä¸€ä¸ªåŸºäº `prompt_toolkit` çš„é«˜çº§å¼‚æ­¥ä»»åŠ¡ç®¡ç†ç»ˆç«¯åº”ç”¨ï¼Œæ”¯æŒä¼˜å…ˆçº§è°ƒåº¦å’Œæ‰“æ–­æœºåˆ¶ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### æ™ºèƒ½è°ƒåº¦ç³»ç»Ÿ
- **ä¼˜å…ˆçº§é˜Ÿåˆ—**: æ”¯æŒ 4 ä¸ªä¼˜å…ˆçº§ç­‰çº§ï¼ˆCritical > High > Normal > Lowï¼‰
- **æ‰“æ–­æœºåˆ¶**: å…³é”®ä»»åŠ¡å¯ä»¥æ‰“æ–­æ‰€æœ‰å…¶ä»–ä»»åŠ¡ï¼Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡åœ¨ç³»ç»Ÿç¹å¿™æ—¶æ‰“æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡
- **å¹¶å‘æ§åˆ¶**: æœ€å¤šåŒæ—¶è¿è¡Œ 3 ä¸ªä»»åŠ¡ï¼Œæ™ºèƒ½è°ƒåº¦ç­‰å¾…é˜Ÿåˆ—
- **å®æ—¶ç›‘æ§**: ä»»åŠ¡çŠ¶æ€å®æ—¶æ›´æ–°ï¼Œæ”¯æŒå–æ¶ˆæ“ä½œ

### äº¤äº’å¼ç»ˆç«¯ç•Œé¢
- **å¯Œæ–‡æœ¬æ˜¾ç¤º**: ä½¿ç”¨è¡¨æƒ…ç¬¦å·å’Œé¢œè‰²åŒºåˆ†ä¸åŒçŠ¶æ€
- **å®æ—¶çŠ¶æ€æ›´æ–°**: ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„çŠ¶æ€å˜åŒ–å®æ—¶æ˜¾ç¤º
- **æ™ºèƒ½å‘½ä»¤è§£æ**: æ”¯æŒå¤šç§å‘½ä»¤æ ¼å¼å’Œå‚æ•°

## ğŸ“‹ ä¼˜å…ˆçº§è¯´æ˜

| ä¼˜å…ˆçº§ | çº§åˆ« | å¤„ç†æ—¶é—´ | æ‰“æ–­èƒ½åŠ› | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|----------|----------|
| **Critical** | 0 | 1ç§’ | æ‰“æ–­æ‰€æœ‰ä»»åŠ¡ | ç´§æ€¥å®‰å…¨æ£€æŸ¥ã€ç³»ç»Ÿæ•…éšœå¤„ç† |
| **High** | 1 | 3ç§’ | åœ¨ç¹å¿™æ—¶æ‰“æ–­ä½ä¼˜å…ˆçº§ | é‡è¦ä¸šåŠ¡å¤„ç†ã€ç›‘æ§å‘Šè­¦ |
| **Normal** | 2 | 5ç§’ | æ— æ‰“æ–­èƒ½åŠ› | å¸¸è§„æ•°æ®å¤„ç†ã€ç”¨æˆ·è¯·æ±‚ |
| **Low** | 3 | 8ç§’ | æ— æ‰“æ–­èƒ½åŠ› | æ‰¹é‡å¤„ç†ã€æ¸…ç†ä»»åŠ¡ |

## ğŸ® ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨åº”ç”¨

```bash
python examples/demo/task.py
```

### ğŸ’» å‘½ä»¤è¯¦è§£

#### åŸºæœ¬å‘½ä»¤
- `help` - æ˜¾ç¤ºå®Œæ•´å¸®åŠ©ä¿¡æ¯
- `clear` - æ¸…ç©ºç»ˆç«¯è¾“å‡º
- `Ctrl+C` - é€€å‡ºç¨‹åº
- `Ctrl+L` - å¿«é€Ÿæ¸…ç©ºè¾“å‡º

#### ä»»åŠ¡ç®¡ç†å‘½ä»¤
```bash
# å‘é€æŒ‡å®šä¼˜å…ˆçº§çš„ä»»åŠ¡
send critical ç´§æ€¥å®‰å…¨æ£€æŸ¥
send high ç³»ç»Ÿç›‘æ§æ£€æŸ¥
send normal ç”¨æˆ·æ•°æ®å¤„ç†
send low æ—¥å¿—æ–‡ä»¶æ¸…ç†

# å¿«é€Ÿå‘é€æ™®é€šä¼˜å…ˆçº§ä»»åŠ¡
å¤„ç†ç”¨æˆ·è®¢å•

# æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€
status task_1

# å–æ¶ˆä»»åŠ¡
cancel task_2

# åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡ï¼ˆç¾è§‚çš„åˆ†ç»„æ˜¾ç¤ºï¼‰
list

# æŸ¥çœ‹è°ƒåº¦å™¨å®æ—¶çŠ¶æ€
scheduler

# è¿è¡Œæ¼”ç¤ºï¼ˆåˆ›å»ºå„ç§ä¼˜å…ˆçº§çš„ç¤ºä¾‹ä»»åŠ¡ï¼‰
demo
```

### ğŸ¯ æ¼”ç¤ºåœºæ™¯

#### åœºæ™¯1ï¼šä¼˜å…ˆçº§è°ƒåº¦æ¼”ç¤º
```bash
1. å¯åŠ¨åº”ç”¨: python examples/demo/task.py
2. è¿è¡Œæ¼”ç¤º: demo
3. è§‚å¯Ÿä»»åŠ¡æ‰§è¡Œé¡ºåºå’Œæ‰“æ–­æœºåˆ¶
4. æŸ¥çœ‹çŠ¶æ€: list
```

#### åœºæ™¯2ï¼šæ‰“æ–­æœºåˆ¶æ¼”ç¤º
```bash
1. åˆ›å»ºä½ä¼˜å…ˆçº§ä»»åŠ¡: send low å¤§æ•°æ®åˆ†æ
2. åˆ›å»ºæ™®é€šä»»åŠ¡: send normal æŠ¥è¡¨ç”Ÿæˆ  
3. ç«‹å³åˆ›å»ºå…³é”®ä»»åŠ¡: send critical å®‰å…¨æ¼æ´æ£€æµ‹
4. è§‚å¯Ÿå…³é”®ä»»åŠ¡å¦‚ä½•æ‰“æ–­å…¶ä»–ä»»åŠ¡
```

#### åœºæ™¯3ï¼šä»»åŠ¡ç®¡ç†æ¼”ç¤º
```bash
1. åˆ›å»ºå¤šä¸ªä»»åŠ¡: send high ä»»åŠ¡A, send normal ä»»åŠ¡B
2. æŸ¥çœ‹çŠ¶æ€: scheduler
3. å–æ¶ˆä»»åŠ¡: cancel task_1
4. æŸ¥çœ‹ç»“æœ: list
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

1. **TaskScheduler** - æ™ºèƒ½è°ƒåº¦å™¨
   - ä¼˜å…ˆçº§é˜Ÿåˆ—ç®¡ç†
   - å¹¶å‘æ§åˆ¶
   - æ‰“æ–­é€»è¾‘å¤„ç†

2. **AsyncTaskManager** - ä»»åŠ¡ç®¡ç†å™¨
   - ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
   - çŠ¶æ€è·Ÿè¸ª
   - è°ƒåº¦å™¨é›†æˆ

3. **AsyncTerminalApp** - äº¤äº’ç•Œé¢
   - å‘½ä»¤è§£æ
   - å®æ—¶çŠ¶æ€æ˜¾ç¤º
   - ç”¨æˆ·äº¤äº’å¤„ç†

### å…³é”®ç®—æ³•

#### ä¼˜å…ˆçº§è°ƒåº¦
- ä½¿ç”¨ Python `heapq` å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—
- ä»»åŠ¡æŒ‰ä¼˜å…ˆçº§å€¼æ’åºï¼ˆæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
- ç›¸åŒä¼˜å…ˆçº§æŒ‰åˆ›å»ºæ—¶é—´æ’åº

#### æ‰“æ–­æœºåˆ¶
- **å…³é”®ä»»åŠ¡**: ç«‹å³å–æ¶ˆæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ä½ä¼˜å…ˆçº§ä»»åŠ¡
- **é«˜ä¼˜å…ˆçº§**: åœ¨å¹¶å‘ä»»åŠ¡æ•° > 2 æ—¶æ‰“æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡
- **ä¼˜é›…å–æ¶ˆ**: ä½¿ç”¨ `asyncio.CancelledError` å®‰å…¨ç»ˆæ­¢ä»»åŠ¡

#### çŠ¶æ€ç®¡ç†
- **é˜Ÿåˆ—çŠ¶æ€**: queued â†’ running â†’ completed/cancelled/failed
- **å®æ—¶æ›´æ–°**: 0.5ç§’æ£€æŸ¥é—´éš”ï¼ŒçŠ¶æ€å˜åŒ–æ—¶ç«‹å³é€šçŸ¥
- **èµ„æºæ¸…ç†**: è‡ªåŠ¨æ¸…ç†å·²å®Œæˆä»»åŠ¡çš„èµ„æº

## ğŸ”§ æŠ€æœ¯å®ç°

### å¼‚æ­¥ç¼–ç¨‹
```python
# ä»»åŠ¡æ‰§è¡Œä½¿ç”¨å¼‚æ­¥åç¨‹
async def _execute_task(self, task_item: TaskItem) -> Dict[str, Any]:
    try:
        processing_time = self.get_processing_time(task_item.priority)
        await asyncio.sleep(processing_time)
        return self.create_success_result(task_item)
    except asyncio.CancelledError:
        return self.create_cancelled_result(task_item)
```

### ä¼˜å…ˆçº§é˜Ÿåˆ—
```python
# ä½¿ç”¨ heapq å®ç°é«˜æ•ˆçš„ä¼˜å…ˆçº§è°ƒåº¦
heapq.heappush(self.priority_queue, task_item)
next_task = heapq.heappop(self.priority_queue)
```

### å®æ—¶ç›‘æ§
```python
# éé˜»å¡çš„ä»»åŠ¡çŠ¶æ€ç›‘æ§
async def _monitor_task(self, task_id: str):
    while True:
        await asyncio.sleep(0.5)
        if status_changed:
            self.update_ui(status)
```

## ğŸ¨ ç”¨æˆ·ç•Œé¢ç‰¹è‰²

- **çŠ¶æ€å›¾æ ‡**: â³ é˜Ÿåˆ—ä¸­ | ğŸ”„ è¿è¡Œä¸­ | âœ… å·²å®Œæˆ | âŒ å·²å–æ¶ˆ | ğŸ’¥ å¤±è´¥
- **ä¼˜å…ˆçº§æ ‡è¯†**: [CRITICAL] [HIGH] [NORMAL] [LOW]
- **å®æ—¶æ—¶é—´æˆ³**: æ¯æ¡è¾“å‡ºéƒ½æœ‰ç²¾ç¡®çš„æ—¶é—´è®°å½•
- **åˆ†ç»„æ˜¾ç¤º**: ä»»åŠ¡æŒ‰çŠ¶æ€æ™ºèƒ½åˆ†ç»„ï¼Œä¾¿äºæŸ¥çœ‹

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **ä»»åŠ¡ä¸æ‰§è¡Œ**: æ£€æŸ¥è°ƒåº¦å™¨æ˜¯å¦å¯åŠ¨ (`scheduler` å‘½ä»¤)
2. **ä¼˜å…ˆçº§ä¸ç”Ÿæ•ˆ**: ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„ä¼˜å…ˆçº§å…³é”®è¯
3. **å–æ¶ˆå¤±è´¥**: ä»»åŠ¡å¯èƒ½å·²ç»å®Œæˆæˆ–ä¸å­˜åœ¨

### è°ƒè¯•æ¨¡å¼
- ä½¿ç”¨ `scheduler` å‘½ä»¤æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€
- ä½¿ç”¨ `list` å‘½ä»¤æŸ¥çœ‹è¯¦ç»†çš„ä»»åŠ¡ä¿¡æ¯
- è§‚å¯Ÿå®æ—¶çŠ¶æ€æ›´æ–°ä¿¡æ¯

## ğŸš€ æ‰©å±•å¯èƒ½

- æ·»åŠ ä»»åŠ¡ä¾èµ–å…³ç³»
- æ”¯æŒå®šæ—¶ä»»åŠ¡
- æ·»åŠ ä»»åŠ¡æŒä¹…åŒ–
- æ”¯æŒåˆ†å¸ƒå¼è°ƒåº¦
- æ·»åŠ æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡

---

**äº«å—æ™ºèƒ½ä»»åŠ¡è°ƒåº¦çš„å¼ºå¤§åŠŸèƒ½ï¼** ğŸ‰
